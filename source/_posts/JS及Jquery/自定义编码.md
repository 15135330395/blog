---
title: 自定义编码
date: 2019-09-21 00:00:00
tags: [自定义编码]
categories: JS及Jquery
---
```javascript
//根据表名和编码字段获取最大编码
function createOAMaxCode(module,tablename,codefiled){
        var yearAndMonth=nui.formatDate(new Date(),"yyyyMM");
        var maxCode  = "";
        var sqlStr =" select max(substr("+codefiled+",-3)) as maxCode from "+tablename+" where "+codefiled+" like '"+module+"-"+new Date().getFullYear()+"%'";
        console.log(sqlStr);
        var ret = ERP.runSql(sqlStr, "select", false);
        console.log(ret);
        var retNum = parseInt(ret.dataObject[0].MAXCODE); 
        console.log(retNum);
        var re = /^[0-9]+.?[0-9]*/;//判断字符串是否为数字//判断正整数/[1−9]+[0−9]∗]∗/ 
        if(ret.result == 'success' && isEmpty(ret.dataObject[0].MAXCODE)){//如果是新的一年则编码从1计数
        maxCode="001";
        }else if( !re.test(ret.dataObject[0].MAXCODE)){//查询出错
        maxCode="编码生成错误，请手动输入..";
        } else{
        maxCode = PrefixInteger(retNum+1,3);//最大编码数值
        }
        var modeCode = module+"-"+yearAndMonth+"-"+maxCode;
        return modeCode;
}
//补0
function PrefixInteger(num, length) {
    return (Array(length).join('0') + num).slice(-length);
}
//判断字符是否为空
function isEmpty(obj){
    if(typeof obj == "undefined" || obj == null || obj == ""){
        return true;
    }else{
        return false;
    }
}
```